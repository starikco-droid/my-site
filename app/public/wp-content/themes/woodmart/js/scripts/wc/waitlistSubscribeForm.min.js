woodmartThemeModule.waitlistSubscribeForm=function(){function r(t,e,a="not-signed"){wtl_form_data.global.is_user_logged_in||(d="woodmart_waitlist_unsubscribe_tokens",(d=Cookies.get(d)?JSON.parse(Cookies.get(d)):{})&&d.hasOwnProperty(e)&&(a="signed"));var o,r,d=document.querySelector(`.wd-wtl-form.wd-wtl-is-template[data-state=${a}]`);if(d)return o=document.querySelector(".wd-wtl-form:not(.wd-wtl-is-template)"),d=d.cloneNode(!0),"not-signed"===a?(r="",d.querySelector(".wd-wtl-subscribe").dataset.productId=e,wtl_form_data.hasOwnProperty("global")&&wtl_form_data.global.email?r=wtl_form_data.global.email:wtl_form_data.hasOwnProperty("email")&&(r=wtl_form_data.email),d.querySelector('[name="wd-wtl-user-subscribe-email"]').value=r,d.addEventListener("click",i)):(d.querySelector(".wd-wtl-unsubscribe").dataset.productId=e,d.addEventListener("click",l)),d.querySelectorAll('[for$="-tmpl"]').forEach(function(t){t.setAttribute("for",t.getAttribute("for").replace("-tmpl",""))}),d.querySelectorAll('[id$="-tmpl"]').forEach(function(t){t.id=t.id.replace("-tmpl","")}),d.classList.remove("wd-wtl-is-template"),d.classList.remove("wd-hide"),o?(o.replaceWith(d),o.classList.remove("wd-hide")):t.after(d),wtl_form_data.hasOwnProperty(e)?wtl_form_data[e].state=a:wtl_form_data.hasOwnProperty("product_id")&&(wtl_form_data.product_id=a),d}function o(t,e,a=0){var o;t&&(o=document.querySelector(".wd-wtl-form:not(.wd-hide)"),o.querySelector(".wd-loader-overlay").classList.add("wd-loading"),jQuery.ajax({url:woodmart_settings.ajaxurl,data:{action:"woodmart_update_form_data",product_id:t},dataType:"json",method:"GET",success:function(t){t.hasOwnProperty("data")&&(t.data.hasOwnProperty("global")&&(wtl_form_data.global=t.data.global),t.data.hasOwnProperty("signed_ids")&&t.data.signed_ids.forEach(function(t){wtl_form_data.hasOwnProperty(t)?wtl_form_data[t].state="signed":wtl_form_data.hasOwnProperty("state")&&(wtl_form_data.state="signed")}),"simple"===e?n(t.data.content):0!==a&&(o=r(document.querySelector(".wd-wtl-form:not(.wd-wtl-is-template)"),a,wtl_form_data[a].state)))},error:function(){console.error("Something wrong with AJAX response. Probably some PHP conflict")},complete:function(){o.querySelector(".wd-loader-overlay").classList.remove("wd-loading")}}))}function t(t){var e=t.target.closest(".wd-wtl-subscribe"),a=t.target.closest(".wd-wtl-unsubscribe");e?i(t):a&&l(t)}function i(t){var e=t.target.closest(".wd-wtl-subscribe");if(e){t.preventDefault();var t=e.closest(".wd-wtl-form"),a=t.querySelector('[name="wd-wtl-policy-check"]'),o=t.querySelector('[name="wd-wtl-user-subscribe-email"]'),o=o?o.value:"";if(data={action:"woodmart_add_to_waitlist",user_email:o,product_id:e.dataset.productId},a)if(!a.checked)return o="",wtl_form_data.hasOwnProperty("global")&&wtl_form_data.global.policy_check_notice?o=wtl_form_data.global.policy_check_notice:wtl_form_data.hasOwnProperty("policy_check_notice")&&(o=wtl_form_data.policy_check_notice),o?void s(t,o,"warning"):void 0;d(t,data)}}function l(t){var e,a=t.target.closest(".wd-wtl-unsubscribe");a&&(t.preventDefault(),t="woodmart_waitlist_unsubscribe_tokens",e=a.closest(".wd-wtl-form"),data={action:"woodmart_remove_from_waitlist",product_id:a.dataset.productId},a=parseInt(data.product_id),(t=Cookies.get(t)?JSON.parse(Cookies.get(t)):{})&&t.hasOwnProperty(a)&&(data.unsubscribe_token=t[a]),d(e,data))}function d(e,a){var t=e.querySelector(".wd-loader-overlay");t.classList.add("wd-loading"),jQuery.ajax({url:woodmart_settings.ajaxurl,data:a,method:"POST",success:function(t){t&&(t.success&&(t.data.hasOwnProperty("content")&&t.data.hasOwnProperty("state")?n(t.data.content):e=r(e,a.product_id,t.data.state)),t.data.hasOwnProperty("notice"))&&($nocite_type=t.success?"success":"warning",t.data.hasOwnProperty("notice_status")&&($nocite_type=t.data.notice_status),s(e,t.data.notice,$nocite_type))},error:function(){console.error("ajax adding to waitlist error")},complete:function(){(t=e.querySelector(".wd-loader-overlay")).classList.remove("wd-loading")}})}function n(t){var e=document.querySelectorAll(".wd-wtl-form:not(.wd-wtl-is-template)"),e=Array.from(e).find(function(t){return!t.closest(".wd-sticky-spacer")}),a=document.createElement("div");a.innerHTML=t,childNodes=a.querySelector(".wd-wtl-form").childNodes,e.replaceChildren(...childNodes)}function s(t,e,a){var o;t&&((o=t.querySelector(".wd-notice"))&&o.remove(),(o=document.createElement("div")).classList.add("wd-notice","wd-"+a),o.append(e),t.append(o))}var c,e,a,w,u,_,m,f;"undefined"!=typeof wtl_form_data&&(e=!1,document.querySelector('body[class*="postid-"]').classList.forEach(function(t){t.includes("postid-")&&(e=t.replace("postid-",""))}),c=e,a=".summary-inner",document.querySelector(".wd-content-layout").classList.contains("wd-builder-on")&&(a=".wd-single-add-cart"),(f=document.querySelector(a+" .variations_form"))?(w=document.querySelector(a+" .wd-active"),u=!1,(_=parseInt(f.querySelector("input.variation_id").value))&&(m=JSON.parse(f.dataset.product_variations).find(function(t){return t.variation_id===_}))&&!m.is_in_stock&&r(f,m.variation_id,wtl_form_data[m.variation_id].state),jQuery(a+" .variations_form").on("show_variation",function(t,e){var a;e.is_in_stock?(a=document.querySelector(".wd-wtl-form:not(.wd-wtl-is-template)"))&&a.remove():(r(this,e.variation_id,wtl_form_data[e.variation_id].state),!u&&wtl_form_data.global.fragments_enable&&wtl_form_data.global.is_user_logged_in&&(o(c,"variation",e.variation_id),u=!0))}).on("click",".reset_variations",function(){var t=document.querySelector(".wd-wtl-form:not(.wd-wtl-is-template)");t&&t.remove()}),document.querySelector(".single-product-page").classList.contains("has-default-attributes")&&w&&jQuery(a+" .variations_form").trigger("reload_product_variations")):(wtl_form_data.hasOwnProperty("fragments_enable")&&wtl_form_data.fragments_enable&&wtl_form_data.is_user_logged_in&&o(c,"simple"),(f=document.querySelector(".wd-wtl-form:not(.wd-wtl-is-template)"))&&f.addEventListener("click",t)))},window.addEventListener("load",function(){woodmartThemeModule.waitlistSubscribeForm()});